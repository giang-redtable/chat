<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat</title>
<link rel="stylesheet" type="text/css" href="./semantic/dist/semantic.min.css">

<style>
.name{ width: 10%; }
.message{ width: 90%; }
.chat{ width: 10%; }
</style>

</head>
<body>
<div class="container">
	<div class="ui fixed red borderless inverted menu" style="border-radius: 0px; margin: 0px;"><h4 class="header item">REDTABLE CHATBOT v0.1</h4></div>
	<!-- Chat log -->
    <div style="overflow-x: hidden; overflow-y: auto;padding:40px 15px 40px 15px;" id="chatLog" class="ui comments" readonly>
      <div class="ui icon small message">
        <i class="comments outline icon"></i>
        <div class="content">
        <div class="header">
          REDTABLE chatbot v0.1
        </div>
        <p>Get the best recommendation menu.</p>
        </div>
      </div>

      <div class="comment">
        <a class="avatar"><img src="/imgs/avatar/5.jpg"></a>
        <div class="content"><a class="author">REDTABLE</a>
          <div class="metadata"><span class="date"></span></div>
          <div class="text">
            메뉴 추천을 위한 정보를 어떤 음식으로 보여드릴까요?<br><br>
            <p>
            <a class="ui olive circular label">1</a> 한식&nbsp;&nbsp;
            <a class="ui green circular label">2</a> 中餐<br>
            </P>
            원하시는 번호를 입력해 주세요.<br>


          </div>
        </div>
      </div>
    </div>
	<!-- Chat log -->

	<!-- Message box -->

	<form id="chat">	
	<input id="name" class="name" type="hidden" readonly>	
  <input id="channel" type="hidden" value=""/>
  <input id="initSet" type="hidden" value=""/>
  <input id="baseCd" type="hidden" value=""/>
  <input id="recomIdx" type="hidden" value="0"/>
  <input id="preData" type="hidden" value=""/>
	

	<div class="ui fixed bottom borderless sticky action input" style="width:100%;">
		<input type="text" id="message" name="message">
		<button id="chat" class="ui red right borderless submit button">Send</button>	
	</div>
	
    </form>

	<!-- Message box -->

  <script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

    <script>
      var socket = io();      
      var dateN = Date.now();

      socket.emit('join:channel', { channelId: dateN });      
      $('#channel').val(dateN);	 

      $('#chat').on('submit', function(e){
        socket.emit('send message', { userName: $('#name').val(), msg: $('#message').val(), channelId: $('#channel').val(), initSet: $('#initSet').val(), baseCd: $('#baseCd').val(), recomIdx: $('#recomIdx').val(), preData: $('#preData').val() });
        $('#message').val("");
        $("#message").focus();
        e.preventDefault();
      });

      socket.on('receive message', function(msg){
        $('#chatLog').append(msg+'<br>');
        $(document).scrollTop($('#chatLog')[0].scrollHeight);
      });

      socket.on('change name', function(name){
        $('#name').val(name);
      });

      socket.on('init set', function(initSet){
        $('#initSet').val(initSet);
      });

      socket.on('recom idx', function(recomIdx){        
        $('#recomIdx').val(recomIdx);
      });

      socket.on('pre data', function(preData){
        console.log(preData);
        $('#preData').val(JSON.stringify(preData));
        console.log($('#preData').val());
      });
	
    </script>
	
	<script src="./semantic/dist/semantic.min.js"></script>
</div>
</body>
</html>